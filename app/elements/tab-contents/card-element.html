<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="card-element">
    <template>
        <style>
            :host {
                display: block;
                padding-top: 10px;
                width: 100%;
            }
            section {
                width: 70%;
                margin: auto;
                text-align: center;
            }
            /* Paper Cards */
            paper-card {
                min-width: 15vw;
                --paper-card: {
                    width: 23%;
                    margin: 5px;
                };
                --paper-card-content: {
                    text-align: left;
                };
                --paper-card-actions: {

                    text-align: right;
                    padding: 0;
                };
            }
            .title {
                display: block;
                font-size: 16px;
                text-overflow: ellipsis;
                overflow-x: hidden;
                white-space: nowrap;
            }
            .subtitle {
                display: block;
                font-size: 12px;
                color: #b5b5b5;
            }
            iron-icon {
                width: 24px;
            }
            paper-button {
                display: inline-block;
                padding: 5px;
                border-right: 1px solid #eee;
            }

            /* Responsive */
            @media all and (max-width: 1000px) {
                section {
                    width: 90%;
                }
            }
            @media all and (max-width: 768px) {
                paper-card {
                    width: calc(50% - 100px);
                    min-width: 265px;
                }
            }
        </style>
        <iron-pages selected="{{selected}}">
            <section name="SPOTLIGHT">
                <iron-ajax
                    id="all-labels"
                    auto
                    url="http://dev.music.tm:3000/music-provider/all"
                    params='{"page":"1", "entries":"20"}'
                    handle-as="json"
                    last-response="{{allLabels}}"
                    on-response="allLabelsHandler"
                    debounce-duration="300"></iron-ajax>

                <template is="dom-repeat" items="{{labelResults}}">
                    <paper-card image="{{item.logo}}">
                        <div class="card-content">
                            <span class="title">{{item.name}}</span>
                        </div>
                    </paper-card>
                </template>
            </section>

            <section name="TRACKS">
                <iron-ajax
                    id="all-tracks"
                    auto
                    url="http://dev.music.tm:3000/track/all"
                    params='{"page":"1", "entries":"20", "include_private":"0"}'
                    handle-as="json"
                    last-response="{{allTracks}}"
                    on-response="allTracksHandler"
                    debounce-duration="300"></iron-ajax>

                <template is="dom-repeat" items="{{trackResults}}">
                    <paper-card image="{{item.album_cover}}" id="{{item.track_id}}" on-mouseover="showActions">
                        <div class="card-content">
                            <span class="title">{{item.title}}</span>
                            <span class="subtitle">{{item.artist}}</span>
                        </div>
                        <div class="card-actions" hidden$="{{ !showCardActions }}">
                            <paper-button>
                                <iron-icon class="add-to-playlist" icon="av:playlist-add"></iron-icon>
                            </paper-button>
                            <paper-button>
                                <iron-icon class="tags" icon="icons:add-box"></iron-icon>
                            </paper-button>
                            <paper-button>
                                <iron-icon class="download" icon="icons:file-download"></iron-icon>
                            </paper-button>
                            <paper-button>
                                <iron-icon class="play" icon="av:play-circle-outline"></iron-icon>
                            </paper-button>
                        </div>
                    </paper-card>
                </template>
            </section>

            <section name="ARTISTS">
                <iron-ajax
                    id="all-artists"
                    auto
                    url="http://dev.music.tm:3000/artist/all"
                    params='{"page":"1", "entries":"20"}'
                    handle-as="json"
                    last-response="{{allArtists}}"
                    on-response="allArtistsHandler"
                    debounce-duration="300"></iron-ajax>

                <template is="dom-repeat" items="{{artistResults}}">
                    <paper-card image="{{item.picture}}">
                        <div class="card-content">
                            <span class="title">{{item.name}}</span>
                        </div>
                    </paper-card>
                </template>
            </section>

            <section name="ALBUMS">
                <iron-ajax
                    id="all-albums"
                    auto
                    url="http://dev.music.tm:3000/album/all"
                    params='{"page":"1", "entries":"20"}'
                    handle-as="json"
                    last-response="{{allAlbums}}"
                    on-response="allAlbumsHandler"
                    debounce-duration="300"></iron-ajax>

                <template is="dom-repeat" items="{{albumResults}}">
                    <paper-card image="{{item.cover}}">
                        <div class="card-content">
                            <span class="title">{{item.name}}</span>
                            <span class="subtitle">{{item.artist}}</span>
                        </div>
                        <div class="card-actions">
                            <paper-button>
                                <iron-icon class="add-to-playlist" icon="av:playlist-add"></iron-icon>
                            </paper-button>
                            <paper-button>
                                <iron-icon class="tags" icon="icons:add-box"></iron-icon>
                            </paper-button>
                            <paper-button>
                                <iron-icon class="download" icon="icons:file-download"></iron-icon>
                            </paper-button>
                            <paper-button>
                                <iron-icon class="play" icon="av:play-circle-outline"></iron-icon>
                            </paper-button>
                        </div>
                    </paper-card>
                </template>
            </section>
        </iron-pages>
    </template>

    <script>
        (function () {
            'use strict';

            Polymer({
                is: 'card-element',
                properties: {
                    type: 'String',
                    selected: 'Number'
                },

                ready: function () {
                    var tracks = this;

                    tracks.showCardActions = true;
                },

                showActions: function (e) {
                    var track = e.srcElement.id;
                },

                allLabelsHandler: function () {
                    this.labelResults = this.allLabels.data.results;

                    for (var i = 0; i < this.labelResults.length; i++) {
                        this.labelResults[i].logo = this.labelResults[i].logo
                                                ? this.labelResults[i].logo
                                                : '/images/cover-art.png';
                    }
                },

                allTracksHandler: function () {
                    this.trackResults = this.allTracks.data.results;

                    for (var i = 0; i < this.trackResults.length; i++) {
                        var track = this.trackResults[i];

                        track.album_cover = track.album_cover
                                            ? track.album_cover
                                            : '/images/cover-art.png';
                    }
                },

                allArtistsHandler: function () {
                    this.artistResults = this.allArtists.data.results;

                    for (var i = 0; i < this.artistResults.length; i++) {
                        var artist = this.artistResults[i];

                        artist.picture = artist.picture
                                        ? artist.picture
                                        : '/images/cover-art.png';
                    }
                },

                allAlbumsHandler: function () {
                    this.albumResults = this.allAlbums.data.results;

                    for (var i = 0; i < this.albumResults.length; i++) {
                        var album = this.albumResults[i];

                        album.cover = album.cover
                                    ? album.cover
                                    : '/images/cover-art.png';
                    }
                }
            });
        })();
    </script>

</dom-module>